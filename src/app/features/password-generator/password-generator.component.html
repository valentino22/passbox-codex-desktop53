<div class="screen">
  <div class="shell">
    <header>
      <a routerLink="/vault" aria-label="Back to vault">
        <span class="material-symbols-outlined">arrow_back_ios_new</span>
      </a>
      <h1>Password Generator</h1>
      <button type="button" class="theme-action" (click)="toggleTheme()" aria-label="Toggle dark/light mode">
        <span class="material-symbols-outlined">{{ isDarkTheme() ? 'light_mode' : 'dark_mode' }}</span>
      </button>
    </header>

    <main>
      <div class="hero">
        <div class="ring" [class.rolling]="isRolling()">
          <span class="spark spark-a"></span>
          <span class="spark spark-b"></span>
          <span class="spark spark-c"></span>
          <span class="material-symbols-outlined">casino</span>
        </div>
        <div class="password-row">
          <div class="password-editor">
            <div class="password-highlight" aria-hidden="true">
              @for (segment of passwordSegments(); track $index) {
                <span [class]="'char-' + segment.type">{{ segment.value }}</span>
              }
            </div>
            <input
              type="text"
              class="password-input"
              [ngModel]="generatedPassword()"
              (ngModelChange)="setGeneratedPassword($event)"
              aria-label="Generated password"
            />
          </div>
          <button type="button" (click)="copyPassword()">
            <span class="material-symbols-outlined">{{ copied() ? 'check' : 'content_copy' }}</span>
          </button>
        </div>
        <div class="strength">
          <div class="meter">
            <div class="meter-fill" [style.width.%]="strength().score"></div>
          </div>
          <span>{{ strength().label }}</span>
        </div>
      </div>

      <section class="panel">
        <h2>Customize Your Password</h2>

        <div class="line length-line">
          <label for="lengthRange">Password Length</label>
          <div class="length-controls">
            <input
              id="lengthRange"
              type="range"
              min="8"
              max="32"
              [ngModel]="length()"
              (ngModelChange)="updateLength($event)"
            />
            <input
              type="number"
              min="8"
              max="32"
              [ngModel]="length()"
              (ngModelChange)="updateLength($event)"
            />
          </div>
        </div>

        <div class="line">
          <span>Uppercase Letters (A-Z)</span>
          <input type="checkbox" [ngModel]="includeUppercase()" (ngModelChange)="setIncludeUppercase($event)" />
        </div>
        <div class="line">
          <span>Lowercase Letters (a-z)</span>
          <input type="checkbox" [ngModel]="includeLowercase()" (ngModelChange)="setIncludeLowercase($event)" />
        </div>
        <div class="line">
          <span>Numbers (0-9)</span>
          <input type="checkbox" [ngModel]="includeNumbers()" (ngModelChange)="setIncludeNumbers($event)" />
        </div>
        <div class="line">
          <span>Special Characters (!@#)</span>
          <input type="checkbox" [ngModel]="includeSpecial()" (ngModelChange)="setIncludeSpecial($event)" />
        </div>
        <div class="line">
          <span>Avoid Ambiguous Characters</span>
          <input type="checkbox" [ngModel]="avoidAmbiguous()" (ngModelChange)="setAvoidAmbiguous($event)" />
        </div>
      </section>

      <button class="roll" type="button" (click)="rollPassword()">
        <span class="material-symbols-outlined">casino</span>
        Roll the Dice!
      </button>

      <section class="panel history-panel">
        <h2>Generator History</h2>
        @if (!history().length) {
          <p class="history-empty">No generated passwords yet.</p>
        } @else {
          <div class="history-list">
            @for (item of history(); track item.id) {
              <article class="history-item">
                <div class="history-meta">{{ historyTimestamp(item.createdAt) }}</div>
                <div class="history-password">{{ item.password }}</div>
                <button type="button" (click)="copyHistoryPassword(item)" aria-label="Copy history password">
                  <span class="material-symbols-outlined">content_copy</span>
                </button>
              </article>
            }
          </div>
        }
      </section>
    </main>

    <footer class="footer">
      <a routerLink="/vault" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
        <span class="material-symbols-outlined">vpn_key</span>
        <span>Vault</span>
      </a>
      <a routerLink="/generator" routerLinkActive="active">
        <span class="material-symbols-outlined">casino</span>
        <span>Generator</span>
      </a>
      <a routerLink="/settings" routerLinkActive="active">
        <span class="material-symbols-outlined">settings</span>
        <span>Settings</span>
      </a>
    </footer>
  </div>
</div>
